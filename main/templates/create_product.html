{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-lg mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4">Create New Product</h2>
    <form id="create-product-form" method="POST">
        {% csrf_token %}
        <div class="mb-4">
            <label for="name" class="block text-sm font-medium text-gray-700">Product Name</label>
            <input type="text" name="name" id="name" placeholder="Enter product name"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="mb-4">
            <label for="price" class="block text-sm font-medium text-gray-700">Price</label>
            <input type="number" name="price" id="price" placeholder="Enter product price"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
            <textarea name="description" id="description" placeholder="Enter product description"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>
        <button type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">Create Product</button>
    </form>
</div>

<script>
    const form = document.getElementById("create-product-form");

    form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(form);
        const data = {
            name: formData.get("name"),
            price: formData.get("price"),
            description: formData.get("description")
        };

        try {
            const response = await fetch("{% url 'main:create_product' %}", {
                method: "POST",
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                    "X-CSRFToken": formData.get("csrfmiddlewaretoken")
                },
                body: formData
            });

            const result = await response.json();

            if (response.ok) {
                showToast("Success", result.message, "success");
                form.reset();
            } else {
                showToast("Error", result.error || "Failed to create product", "error");
            }
        } catch (err) {
            showToast("Error", "Something went wrong", "error");
        }
    });
</script>
{% endblock %}