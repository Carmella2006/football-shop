{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-lg mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4">Delete Product</h2>
    <p class="mb-4">Are you sure you want to delete the product <strong>{{ product.name }}</strong>?</p>
    <button id="delete-btn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">Delete
        Product</button>
    <a href="{% url 'main:show_main' %}"
        class="ml-4 bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition-colors">Cancel</a>
</div>

<script>
    const deleteBtn = document.getElementById("delete-btn");

    deleteBtn.addEventListener("click", async function () {
        if (!confirm("Are you sure you want to delete this product?")) return;

        try {
            const response = await fetch("{% url 'main:delete_product' product.id %}", {
                method: "DELETE",
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
            });

            const result = await response.json();

            if (response.ok) {
                showToast("Success", result.message, "success");
                // Optional: redirect after short delay
                setTimeout(() => {
                    window.location.href = "{% url 'main:show_main' %}";
                }, 1500);
            } else {
                showToast("Error", result.error || "Failed to delete product", "error");
            }
        } catch (err) {
            showToast("Error", "Something went wrong", "error");
        }
    });
</script>
{% endblock %}